---
permalink: protect-scsql/task_clone_from_a_sql_server_database_backup.html 
sidebar: sidebar 
keywords: clone 
summary: Puede utilizar SnapCenter para clonar una copia de seguridad de una base de datos de SQL Server.  Si desea acceder o restaurar una versión anterior de los datos, puede clonar copias de seguridad de la base de datos a pedido. 
---
= Clonar desde una copia de seguridad de la base de datos de SQL Server
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Puede utilizar SnapCenter para clonar una copia de seguridad de una base de datos de SQL Server.  Si desea acceder o restaurar una versión anterior de los datos, puede clonar copias de seguridad de la base de datos a pedido.

.Antes de empezar
* Debe haberse preparado para la protección de datos completando tareas como agregar hosts, identificar recursos y crear conexiones al sistema de almacenamiento.
* Deberías haber realizado copias de seguridad de las bases de datos o de los grupos de recursos.
* El tipo de protección, como espejo, bóveda o espejo-bóveda para LUN de datos y LUN de registro, debe ser el mismo para descubrir localizadores secundarios durante la clonación a un host alternativo mediante copias de seguridad de registros.
* Si no se puede encontrar la unidad clonada montada durante una operación de clonación de SnapCenter , debe cambiar el parámetro CloneRetryTimeout de SnapCenter Server a 300.
* Debe asegurarse de que los agregados que alojan los volúmenes estén en la lista de agregados asignados de la máquina virtual de almacenamiento (SVM).


.Acerca de esta tarea
* Al clonar una instancia de base de datos independiente, asegúrese de que la ruta del punto de montaje exista y que sea un disco dedicado.
* Al clonar en una instancia de clúster de conmutación por error (FCI), asegúrese de que existan los puntos de montaje, que sea un disco compartido y que la ruta y la FCI pertenezcan al mismo grupo de recursos SQL.
* Asegúrese de que solo haya un iniciador vFC o FC conectado a cada host.  Esto se debe a que SnapCenter solo admite un iniciador por host.
* Si la base de datos de origen o la instancia de destino está en un volumen compartido de clúster (csv), entonces la base de datos clonada estará en el csv.
* SCRIPTS_PATH se define utilizando la clave PredefinedWindowsScriptsDirectory ubicada en el archivo SMCoreServiceHost.exe.Config del host del complemento.
+
Si es necesario, puede cambiar esta ruta y reiniciar el servicio SMcore.  Se recomienda que utilice la ruta predeterminada por seguridad.

+
El valor de la clave se puede mostrar desde swagger a través de la API: API /4.7/configsettings

+
Puede utilizar la API GET para mostrar el valor de la clave.  La API SET no es compatible.




NOTE: Para entornos virtuales (VMDK/RDM), asegúrese de que el punto de montaje sea un disco dedicado.

* Para ONTAP 9.12.1 y versiones anteriores, los clones creados a partir de las instantáneas de SnapLock Vault como parte de la restauración heredarán el tiempo de vencimiento de SnapLock Vault. El administrador de almacenamiento debe limpiar manualmente los clones después del tiempo de vencimiento de SnapLock .


[role="tabbed-block"]
====
.Interfaz de usuario de SnapCenter
--
.Pasos
. En el panel de navegación izquierdo, seleccione *Recursos* y, a continuación, seleccione *Complemento de SnapCenter para SQL Server* de la lista.
. En la página Recursos, seleccione *Base de datos* o *Grupo de recursos* en la lista *Ver*.
+

NOTE: No se admite la clonado del backup de una instancia.

. Seleccione la base de datos o el grupo de recursos.
. Desde la página de vista *Administrar copias*, seleccione la copia de seguridad del sistema de almacenamiento primario o secundario (duplicado o almacenado en bóveda).
. Seleccione la copia de seguridad y luego seleccione *image:../media/clone_icon.gif["icono de clonación"] *.
. En la página *Opciones de clonación*, realice las siguientes acciones:
+
|===
| Para este campo... | Haz esto... 


 a| 
Servidor clonado
 a| 
Seleccione un host en el que se debe crear el clon.



 a| 
Instancia de clonación
 a| 
Seleccione una instancia de clonación en la que desea clonar la copia de seguridad de la base de datos.

Esta instancia de SQL debe estar ubicada en el servidor clon especificado.



 a| 
Sufijo de clonación
 a| 
Introduzca un sufijo que se agregará al nombre del archivo clonado para identificar que la base de datos es un clon.

Por ejemplo, _db1_clone_.  Si está clonando en la misma ubicación que la base de datos original, debe proporcionar un sufijo para diferenciar la base de datos clonada de la base de datos original.  De lo contrario la operación falla.



 a| 
Asignar automáticamente el punto de montaje o Asignar automáticamente el punto de montaje del volumen en la ruta
 a| 
Elija si desea asignar automáticamente un punto de montaje o un punto de montaje de volumen bajo una ruta.

Asignar automáticamente el punto de montaje del volumen bajo la ruta: el punto de montaje bajo una ruta le permite proporcionar un directorio específico.  Los puntos de montaje se crearán dentro de ese directorio.  Antes de elegir esta opción, debe asegurarse de que el directorio esté vacío.  Si hay una base de datos en el directorio, la base de datos estará en un estado no válido después de la operación de montaje.

|===
. En la página Registros, seleccione una de las siguientes opciones:
+
|===
| Para este campo... | Haz esto... 


 a| 
Ninguno
 a| 
Elija esta opción cuando desee clonar solo la copia de seguridad completa sin ningún registro.



 a| 
Todas las copias de seguridad de registros
 a| 
Elija esta opción para clonar todas las copias de seguridad de registros disponibles con fecha posterior a la copia de seguridad completa.



 a| 
Mediante copias de seguridad de registros hasta
 a| 
Elija esta opción para clonar la base de datos en función de los registros de respaldo que se crearon hasta el registro de respaldo con la fecha seleccionada.



 a| 
Por fecha específica hasta
 a| 
Especifique la fecha y la hora después de las cuales los registros de transacciones no se aplicarán a la base de datos clonada.

Este clon de punto en el tiempo detiene la clonación de las entradas del registro de transacciones que se registraron después de la fecha y hora especificadas.

|===
. En la página *Script*, ingrese el tiempo de espera del script, la ruta y los argumentos del prescript o postscript que se deben ejecutar antes o después de la operación de clonación, respectivamente.
+
Por ejemplo, puede ejecutar un script para actualizar trampas SNMP, automatizar alertas, enviar registros, etc.

+

NOTE: La ruta de prescripts o posscripts no debe incluir unidades ni recursos compartidos.  La ruta debe ser relativa a SCRIPTS_PATH.

+
El tiempo de espera predeterminado del script es de 60 segundos.

. En la página *Notificación*, de la lista desplegable *Preferencias de correo electrónico*, seleccione los escenarios en los que desea enviar los correos electrónicos.
+
También debe especificar las direcciones de correo electrónico del remitente y del destinatario, y el asunto del correo electrónico.  Si desea adjuntar el informe de la operación de clonación realizada, seleccione *Adjuntar informe de trabajo*.

+

NOTE: Para recibir notificaciones por correo electrónico, debe haber especificado los detalles del servidor SMTP mediante la GUI o el comando de PowerShell Set-SmSmtpServer.

+
Para EMS, puede consultar https://docs.netapp.com/us-en/snapcenter/admin/concept_manage_ems_data_collection.html["Gestionar la recopilación de datos de EMS"]

. Revise el resumen y luego seleccione *Finalizar*.
. Supervise el progreso de la operación seleccionando *Monitor* > *Trabajos*.


.Después de terminar
Una vez creado el clon, nunca debes cambiarle el nombre.

.Información relacionada
https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Clone_operation_might_fail_or_take_longer_time_to_complete_with_default_TCP_TIMEOUT_value["La operación de clonación puede fallar o tardar más tiempo en completarse con el valor TCP_TIMEOUT predeterminado"]

https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/The_failover_cluster_instance_database_clone_fails["La clonación de la base de datos de la instancia del clúster de conmutación por error falla"]

--
.Cmdlets de PowerShell
--
.Pasos
. Inicie una sesión de conexión con el servidor SnapCenter para un usuario específico mediante el cmdlet Open-SmConnection.
+
[listing]
----
Open-SmConnection  -SMSbaseurl  https://snapctr.demo.netapp.com:8146
----
. Enumere las copias de seguridad que se pueden clonar mediante el cmdlet Get-SmBackup o Get-SmResourceGroup.
+
Este ejemplo muestra información sobre todas las copias de seguridad disponibles:

+
[listing]
----
C:\PS>PS C:\> Get-SmBackup

BackupId   BackupName                     BackupTime   BackupType
--------   ----------                     ----------   ----------
1          Payroll Dataset_vise-f6_08...  8/4/2015     Full Backup
                                          11:02:32 AM

2          Payroll Dataset_vise-f6_08...  8/4/2015
                                          11:23:17 AM
----
+
Este ejemplo muestra información sobre un grupo de recursos específico, sus recursos y políticas asociadas:

+
[listing]
----
PS C:\> Get-SmResourceGroup -ListResources –ListPolicies

Description :
CreationTime : 8/4/2015 3:44:05 PM
ModificationTime : 8/4/2015 3:44:05 PM
EnableEmail : False
EmailSMTPServer :
EmailFrom :
EmailTo :
EmailSubject :
EnableSysLog : False
ProtectionGroupType : Backup
EnableAsupOnFailure : False
Policies : {FinancePolicy}
HostResourceMaping : {}
Configuration : SMCoreContracts.SmCloneConfiguration
LastBackupStatus :
VerificationServer :
EmailBody :
EmailNotificationPreference : Never
VerificationServerInfo : SMCoreContracts.SmVerificationServerInfo
SchedulerSQLInstance :
CustomText :
CustomSnapshotFormat :
SearchResources : False
ByPassCredential : False
IsCustomSnapshot :
MaintenanceStatus : Production
PluginProtectionGroupTypes : {SMSQL}
Name : Payrolldataset
Type : Group
Id : 1
Host :
UserName :
Passphrase :
Deleted : False
Auth : SMCoreContracts.SmAuth
IsClone : False
CloneLevel : 0
ApplySnapvaultUpdate : False
ApplyRetention : False
RetentionCount : 0
RetentionDays : 0
ApplySnapMirrorUpdate : False
SnapVaultLabel :
MirrorVaultUpdateRetryCount : 7
AppPolicies : {}
Description : FinancePolicy
PreScriptPath :
PreScriptArguments :
PostScriptPath :
PostScriptArguments :
ScriptTimeOut : 60000
DateModified : 8/4/2015 3:43:30 PM
DateCreated : 8/4/2015 3:43:30 PM
Schedule : SMCoreContracts.SmSchedule
PolicyType : Backup
PluginPolicyType : SMSQL
Name : FinancePolicy
Type :
Id : 1
Host :
UserName :
Passphrase :
Deleted : False
Auth : SMCoreContracts.SmAuth
IsClone : False
CloneLevel : 0
clab-a13-13.sddev.lab.netapp.com
DatabaseGUID :
SQLInstance : clab-a13-13
DbStatus : AutoClosed
DbAccess : eUndefined
IsSystemDb : False
IsSimpleRecoveryMode : False
IsSelectable : True
SqlDbFileGroups : {}
SqlDbLogFiles : {}
AppFileStorageGroups : {}
LogDirectory :
AgName :
Version :
VolumeGroupIndex : -1
IsSecondary : False
Name : TEST
Type : SQL Database
Id : clab-a13-13\TEST
Host : clab-a13-13.sddev.mycompany.com
UserName :
Passphrase :
Deleted : False
Auth : SMCoreContracts.SmAuth
IsClone : False
----
. Inicie una operación de clonación desde una copia de seguridad existente utilizando el cmdlet New-SmClone.
+
Este ejemplo crea un clon a partir de una copia de seguridad especificada con todos los registros:

+
[listing]
----
PS C:\> New-SmClone
-BackupName payroll_dataset_vise-f3_08-05-2015_15.28.28.9774
-Resources @{"Host"="vise-f3.sddev.mycompany.com";
"Type"="SQL Database";"Names"="vise-f3\SQLExpress\payroll"}
-CloneToInstance vise-f3\sqlexpress -AutoAssignMountPoint
-Suffix _clonefrombackup
-LogRestoreType All -Policy clonefromprimary_ondemand

PS C:> New-SmBackup -ResourceGroupName PayrollDataset -Policy FinancePolicy
----
+
Este ejemplo crea un clon de una instancia específica de Microsoft SQL Server:

+
[listing]
----
PS C:\> New-SmClone
-BackupName "BackupDS1_NY-VM-SC-SQL_12-08-2015_09.00.24.8367"
-Resources @{"host"="ny-vm-sc-sql";"Type"="SQL Database";
"Names"="ny-vm-sc-sql\AdventureWorks2012_data"}
-AppPluginCode SMSQL -CloneToInstance "ny-vm-sc-sql"
-Suffix _CLPOSH -AssignMountPointUnderPath "C:\SCMounts"
----
. Vea el estado del trabajo de clonación mediante el cmdlet Get-SmCloneReport.
+
Este ejemplo muestra un informe clonado para el ID de trabajo especificado:

+
[listing]
----
PS C:\> Get-SmCloneReport -JobId 186

SmCloneId : 1
SmJobId : 186
StartDateTime : 8/3/2015 2:43:02 PM
EndDateTime : 8/3/2015 2:44:08 PM
Duration : 00:01:06.6760000
Status : Completed
ProtectionGroupName : Draper
SmProtectionGroupId : 4
PolicyName : OnDemand_Clone
SmPolicyId : 4
BackupPolicyName : OnDemand_Full_Log
SmBackupPolicyId : 1
CloneHostName : SCSPR0054212005.mycompany.com
CloneHostId : 4
CloneName : Draper__clone__08-03-2015_14.43.53
SourceResources : {Don, Betty, Bobby, Sally}
ClonedResources : {Don_DRAPER, Betty_DRAPER, Bobby_DRAPER,
                   Sally_DRAPER}
----


La información sobre los parámetros que se pueden utilizar con el cmdlet y sus descripciones se puede obtener ejecutando _Get-Help command_name_. Alternativamente, también puede consultar la https://docs.netapp.com/us-en/snapcenter-cmdlets/index.html["Guía de referencia de cmdlets del software SnapCenter"^] .

--
====