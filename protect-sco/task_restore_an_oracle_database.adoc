---
permalink: protect-sco/task_restore_an_oracle_database.html 
sidebar: sidebar 
keywords: restore, recover, Oracle 
summary: En caso de pérdida de datos, puede utilizar SnapCenter para restaurar datos de una o más copias de seguridad en su sistema de archivos activo y luego recuperar la base de datos. 
---
= Restaurar y recuperar la base de datos Oracle
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
En caso de pérdida de datos, puede utilizar SnapCenter para restaurar datos de una o más copias de seguridad en su sistema de archivos activo y luego recuperar la base de datos.

*Antes de empezar*

Si ha instalado el complemento como un usuario no root, debe asignar manualmente los permisos de ejecución a los directorios prescript y postscript.

*Acerca de esta tarea*

* La recuperación se realiza utilizando los registros de archivo disponibles en la ubicación del registro de archivo configurado.  Si la base de datos se ejecuta en modo ARCHIVELOG, la base de datos Oracle guarda los grupos completos de archivos de registro de rehacer en uno o más destinos fuera de línea, conocidos colectivamente como el registro de rehacer archivado.  SnapCenter identifica y monta la cantidad óptima de copias de seguridad de registros según el SCN especificado, la fecha y hora seleccionadas o la opción de todos los registros.  Si los registros de archivo necesarios para la recuperación no están disponibles en la ubicación configurada, debe montar la instantánea que contiene los registros y especificar la ruta como registros de archivo externos.
+
Si migra la base de datos ASM de ASMLIB a ASMFD, las copias de seguridad creadas con ASMLIB no se podrán utilizar para restaurar la base de datos.  Debe crear copias de seguridad en la configuración de ASMFD y usar esas copias de seguridad para restaurar.  De manera similar, si la base de datos ASM se migra de ASMFD a ASMLIB, debe crear copias de seguridad en la configuración de ASMLIB para restaurarla.

+
Cuando se restaura una base de datos, se crea un archivo de bloqueo operativo (.sm_lock_dbsid) en el host de la base de datos Oracle en el directorio _/var/opt/snapcenter/sco/lock_ para evitar que se ejecuten múltiples operaciones en la base de datos.  Una vez restaurada la base de datos, el archivo de bloqueo operativo se elimina automáticamente.

+

NOTE: No se admite la restauración de archivos SPFILE y de contraseña.

* Para las políticas habilitadas para SnapLock , para ONTAP 9.12.1 y versiones anteriores, si especifica un período de bloqueo de instantáneas, los clones creados a partir de las instantáneas a prueba de manipulaciones como parte de la restauración heredarán el tiempo de vencimiento de SnapLock . El administrador de almacenamiento debe limpiar manualmente los clones después del tiempo de vencimiento de SnapLock .


*Pasos*

. En el panel de navegación izquierdo, haga clic en *Recursos* y luego seleccione el complemento apropiado de la lista.
. En la página Recursos, seleccione *Base de datos* o *Grupo de recursos* en la lista *Ver*.
. Seleccione la base de datos desde la vista de detalles de la base de datos o desde la vista de detalles del grupo de recursos.
+
Se muestra la página de topología de la base de datos.

. Desde la vista Administrar copias, seleccione *Copias de seguridad* de los sistemas de almacenamiento primario o secundario (duplicado o reflejado).
. Seleccione la copia de seguridad de la tabla y luego haga clic en *image:../media/restore_icon.gif["icono de restauración"] *.
. En la página Restaurar ámbito, realice las siguientes tareas:
+
.. Si ha seleccionado una copia de seguridad de una base de datos en un entorno de Real Application Clusters (RAC), seleccione el nodo RAC.
.. Al seleccionar datos reflejados o de bóveda:
+
*** Si no hay copias de seguridad de registros en el espejo o la bóveda, no se selecciona nada y los localizadores están vacíos.
*** Si existen copias de seguridad de registros en el espejo o en la bóveda, se selecciona la última copia de seguridad de registros y se muestra el localizador correspondiente.
+

NOTE: Si la copia de seguridad del registro seleccionada existe tanto en la ubicación del espejo como en la del almacén, se muestran ambos localizadores.



.. Realice las siguientes acciones:
+
|===
| Si deseas restaurar... | Haz esto... 


 a| 
Todos los archivos de datos de la base de datos
 a| 
Seleccionar *Todos los archivos de datos*.

Sólo se restauran los archivos de datos de la base de datos.  Los archivos de control, los registros de archivo o los archivos de registro de rehacer no se restauran.



 a| 
Espacios de tabla
 a| 
Seleccione *Espacios de tabla*.

Puede especificar los espacios de tabla que desea restaurar.



 a| 
Archivos de control
 a| 
Seleccione *Archivos de control*.


NOTE: Al restaurar archivos de control, asegúrese de que la estructura del directorio exista o deba crearse con los propietarios de usuarios y grupos correctos, si los hubiera, para permitir que el proceso de restauración copie los archivos a la ubicación de destino.  Si el directorio no existe, el trabajo de restauración fallará.



 a| 
Archivos de registro de rehacer
 a| 
Seleccione *Rehacer archivos de registro*.

Esta opción solo está disponible para bases de datos en espera de Data Guard o en espera de Data Guard activa.


NOTE: No se realiza una copia de seguridad de los archivos de registro de rehacer para bases de datos que no sean Data Guard.  Para las bases de datos que no son Data Guard, la recuperación se realiza mediante registros de archivo.



 a| 
Bases de datos conectables (PDB)
 a| 
Seleccione *Bases de datos conectables* y, a continuación, especifique los PDB que desea restaurar.



 a| 
Espacios de tablas de bases de datos conectables (PDB)
 a| 
Seleccione *Espacios de tabla de base de datos conectable (PDB)* y, a continuación, especifique la PDB y los espacios de tabla de esa PDB que desea restaurar.

Esta opción solo está disponible si ha seleccionado un PDB para restaurar.

|===
.. Seleccione *Cambiar el estado de la base de datos si es necesario para restaurar y recuperar* para cambiar el estado de la base de datos al estado requerido para realizar operaciones de restauración y recuperación.
+
Los distintos estados de una base de datos, de superior a inferior, son abierto, montado, iniciado y apagado.  Debe seleccionar esta casilla de verificación si la base de datos está en un estado superior pero el estado debe cambiarse a un estado inferior para realizar una operación de restauración.  Si la base de datos está en un estado inferior pero el estado debe cambiarse a un estado superior para realizar la operación de restauración, el estado de la base de datos cambia automáticamente incluso si no selecciona la casilla de verificación.

+
Si una base de datos está en estado abierto y para restaurarla debe estar en estado montado, el estado de la base de datos se cambia solo si selecciona esta casilla de verificación.

.. Seleccione *Forzar restauración en el lugar* si desea realizar una restauración en el lugar en los escenarios en los que se agregan nuevos archivos de datos después de la copia de seguridad o cuando se agregan, eliminan o vuelven a crear LUN en un grupo de discos LVM.


. En la página Ámbito de recuperación, realice las siguientes acciones:
+
|===
| Si usted... | Haz esto... 


 a| 
¿Quieres recuperar la última transacción?
 a| 
Seleccionar *Todos los registros*.



 a| 
¿Quieres recuperar un Número de cambio de sistema (SCN) específico?
 a| 
Seleccione *Hasta SCN (Número de cambio del sistema)*.



 a| 
¿Quieres recuperar datos y tiempos específicos?
 a| 
Seleccione *Fecha y hora*.

Debe especificar la fecha y la hora de la zona horaria del host de la base de datos.



 a| 
No quiero recuperarme
 a| 
Seleccione *Sin recuperación*.



 a| 
¿Desea especificar cualquier ubicación de registro de archivo externo?
 a| 
Si la base de datos se ejecuta en modo ARCHIVELOG, SnapCenter identifica y monta la cantidad óptima de copias de seguridad de registros según el SCN especificado, la fecha y hora seleccionadas o la opción de todos los registros.

Si aún desea especificar la ubicación de los archivos de registro de archivo externo, seleccione *Especificar ubicaciones de registros de archivo externo*.

Si los registros de archivo se eliminan como parte de la copia de seguridad y usted ha montado manualmente las copias de seguridad de registros de archivo necesarias, debe especificar la ruta de copia de seguridad montada como la ubicación del registro de archivo externo para la recuperación.


NOTE: Debe verificar la ruta y el contenido de la ruta de montaje antes de incluirla como ubicación de registro externo.

** https://docs.netapp.com/us-en/ontap-apps-dbs/oracle/oracle-dp-overview.html["Protección de datos de Oracle con ONTAP"^]
** https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["La operación falla con el error ORA-00308"^]


|===
+
No se puede realizar una restauración con recuperación desde copias de seguridad secundarias si los volúmenes de registro de archivo no están protegidos, pero los volúmenes de datos sí lo están.  Solo puedes restaurar seleccionando *Sin recuperación*.

+
Si está recuperando una base de datos RAC con la opción de base de datos abierta seleccionada, solo la instancia de RAC donde se inició la operación de recuperación vuelve al estado abierto.

+

NOTE: La recuperación no es compatible con las bases de datos en espera de Data Guard y en espera de Data Guard activa.

. En la página PreOps, ingrese la ruta y los argumentos del script que desea ejecutar antes de la operación de restauración.
+
Debes almacenar los scripts en la ruta _/var/opt/snapcenter/spl/scripts_ o en cualquier carpeta dentro de esta ruta.  De forma predeterminada, se completa la ruta _/var/opt/snapcenter/spl/scripts_.  Si ha creado alguna carpeta dentro de esta ruta para almacenar los scripts, debe especificar esas carpetas en la ruta.

+
También puede especificar el valor de tiempo de espera del script. El valor predeterminado es 60 segundos.

+
SnapCenter le permite utilizar las variables de entorno predefinidas cuando ejecuta prescript y postscript.link:../protect-sco/predefined-environment-variables-prescript-postscript-restore.html["Más información"^]

. En la página PostOps, realice los siguientes pasos:
+
.. Introduzca la ruta y los argumentos del postscript que desea ejecutar después de la operación de restauración.
+
Debes almacenar los postscripts en _/var/opt/snapcenter/spl/scripts_ o en cualquier carpeta dentro de esta ruta.  De forma predeterminada, se completa la ruta _/var/opt/snapcenter/spl/scripts_.  Si ha creado alguna carpeta dentro de esta ruta para almacenar los scripts, debe especificar esas carpetas en la ruta.

+

NOTE: Si la operación de restauración falla, los postscripts no se ejecutarán y las actividades de limpieza se activarán directamente.

.. Seleccione la casilla de verificación si desea abrir la base de datos después de la recuperación.
+
Después de restaurar una base de datos contenedora (CDB) con o sin archivos de control, o después de restaurar solo los archivos de control de CDB, si especifica abrir la base de datos después de la recuperación, solo se abre la CDB y no las bases de datos conectables (PDB) en esa CDB.

+
En una configuración de RAC, solo se abre la instancia de RAC que se utiliza para la recuperación después de la recuperación.

+

NOTE: Después de restaurar un espacio de tabla de usuario con archivos de control, un espacio de tabla de sistema con o sin archivos de control, o un PDB con o sin archivos de control, solo el estado del PDB relacionado con la operación de restauración cambia al estado original.  El estado de los otros PDB que no se usaron para la restauración no se cambia al estado original porque el estado de esos PDB no se guardó.  Debe cambiar manualmente el estado de los PDB que no se utilizaron para la restauración.



. En la página Notificación, en la lista desplegable *Preferencia de correo electrónico*, seleccione los escenarios en los que desea enviar las notificaciones por correo electrónico.
+
También debe especificar las direcciones de correo electrónico del remitente y del destinatario, y el asunto del correo electrónico.  Si desea adjuntar el informe de la operación de restauración realizada, deberá seleccionar *Adjuntar informe de trabajo*.

+

NOTE: Para recibir notificaciones por correo electrónico, debe haber especificado los detalles del servidor SMTP mediante la GUI o el comando de PowerShell Set-SmSmtpServer.

. Revise el resumen y luego haga clic en *Finalizar*.
. Supervise el progreso de la operación haciendo clic en *Monitor* > *Trabajos*.


*Para más información*

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Oracle_RAC_One_Node_database_is_skipped_for_performing_SnapCenter_operations["La base de datos Oracle RAC One Node se omite para realizar operaciones de SnapCenter"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_restore_from_a_secondary_SnapMirror_or_SnapVault_location["No se pudo restaurar desde una ubicación secundaria de SnapMirror o SnapVault"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_restore_when_a_backup_of_an_orphan_incarnation_is_selected["No se pudo restaurar desde una copia de seguridad de una encarnación huérfana"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["Parámetros personalizables para operaciones de copia de seguridad, restauración y clonación en sistemas AIX"^]

